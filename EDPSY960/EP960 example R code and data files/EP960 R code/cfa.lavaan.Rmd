---
title: "EP 960 Confirmatory Factor Analysis"
author: "David Kaplan"
output:
  html_document: default
---

```{r,echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Install relevant packages
install.packages("lavaan")

install.packages("semTools")

```{r,echo=TRUE}
library(lavaan)
library(semTools)
library(dplyr)
```

# Read in data

### These data are based on responses from 876 Indonesian teachers to a teacher burnout inventory.  The hypothesized constructs and variables are measured on a 1=strongly disagree to 5=strongly agree scale

Teacher Self-Concept (TSC, 5)
1.	I think I have good teaching skills and ability.
2.	I have a reputation for being an efficient teacher.
3.	My colleagues regard me as a competent teacher. 
4.	I feel I am a valuable person.
5.	Generally speaking, I am a good teacher.

Teacher Efficacy (TE, 5)
1.	I help my students value learning.
2.	I motivate students who show low interest in schoolwork .
3.	I improve understanding of students who are failing.
4.	I provide appropriate challenges for very capable students. 
5.	I get students the students to follow classroom rules. 

Emotional Exhaustion (EE, 5) 
1.	I feel emotionally drained from my work.
2.	I feel used up at the end of the workday. 
3.	I feel fatigued when I get up in the morning and have to face another day on the job.
4.	I feel burnt out from my work. 
5.	Working with people all day is really a strain on me. 

Depersonalization (DP, 3)
1.	I’ve become more callous toward people since I took this job.
2.	I worry that this job is hardening me emotionally.
3.	I feel frustrated by my job.

Reduced Personal Accomplishment (RPA, 7)
1.	I cannot easily create a relaxed atmosphere with my students.
2.	I do not feel exhilarated after working closely with my students.
3.	I have not accomplished many worthwhile things in this job.
4.	I do not feel like I’m at the end of my rope.
5.	In my work, I do not deal with emotional problems very calmly.


```{r,echo=TRUE}
burnoutCFA <- read.csv("~/desktop/TeachBurnout.csv",header=T)
burnoutCFA <- burnoutCFA[is.finite(rowSums(burnoutCFA)),]
```

# Set up CFA model
```{r,echo=TRUE}
burnoutCFA.model <- ' TSC =~ TSC1+TSC2+TSC3+TSC4+TSC5          
                      TE  =~ TE1+TE2+TE3+TE4+TE4
                      EE  =~ EE1+EE2+EE3+EE4+EE5
                      DE  =~ DE1+DE2+DE3
                      RPA =~ RPA1+RPA2+RPA3+RPA4+RPA5'
```

# Obtain fit indices
```{r,echo=TRUE}
fitBurnoutCFA <- cfa(burnoutCFA.model, data=burnoutCFA)
summary(fitBurnoutCFA, fit.measures=TRUE)
standardizedSolution(fitBurnoutCFA)
```
These are the results of confirmatory factor analysis on the teacher burnout data data.  The results are consistent with what was found in the ML EFA solution suggesting that the additional constraints placed on the solution when using CFA do not seem to substantially change the overall conclusions, at least with respect to the RMSEA.  


# Obtain modification indices
```{r,echo=TRUE}
modindices1 <- modindices(fitBurnoutCFA,standardized=TRUE,power=TRUE,delta=0.1,alpha=.05,high.power=.80)
modindices1$decision = as.factor(modindices1$decision)
modindices1$decision = factor(modindices1$decision, levels(modindices1$decision)[c(3,4,1,5,2)])
modindices1 %>%
  mutate_if(is.numeric, ~round(.,1)) %>%
  subset(op != "~~") %>%
  arrange(desc(abs(epc))) %>%
  arrange(decision)
```

In the context of CFA, the modifications are indicative of cross-loadings or possible other measurement issues.  You must be VERY CAREFUL in allowing a cross-loading to be freed as it often indicates a poorly worded item or some other conceptual issue.  Here we see that the largest positive factor loading that could be freed is TE =~  EE5.  The codes indicate a possible misspecification, but the SEPC values are not large, and substantively, it would not make much sense to free the cross-loading.  