---
title: "EP 960 Structural Equation Modeling"
author: "David Kaplan"
output:
  html_document: default
pdf_document: default


---

```{r,echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Install relevant packages
install.packages("lavaan")

install.packages("semTools")

```{r,echo=TRUE}
library(lavaan)
library(semTools)
```

# Read in data
```{r,echo=TRUE}
scimodel <- read.csv("~/desktop/scimodelsem.csv",header=T)
summary(scimodel)
```


## Specify measurement and structural model
```{r,echo=TRUE}
semmodel <- ' 

# Measurement Part

involv =~ makemeth+ownexp+choice
chall  =~ challenge+understand+workhard

# regressions
sciach ~ scigrade10
scigrade10 ~ scigrade6+ses+certsci+chall
chall ~ involv
involv ~ certsci

'
```
# Obtain results
```{r,echo=TRUE}
fitml <- sem(semmodel,data=scimodel,estimator="ml")
summary(fitml, fit.measures=TRUE)
```

The important aspect of these results is that the measurement model specifies some variables as latent.  The regressions of the variables that are latent are improved by accounting for measurement error through the specification of the latent variables.  These are unstandardized regression coefficients and are interprted as such.

# Obtain standardized solution
```{r,echo=TRUE}
standardizedSolution(fitml)
```
# Obtain modification indices
```{r,echo=TRUE}
modindices(fitml,standardized=TRUE,power=TRUE,delta=0.1,alpha=.05,high.power=.80)
```

The modification indices are presented as before.  However, here we see additional modification indices involving the measurement part of the model.  It would be difficult to defend making changes to the measurement part of the model at this point because, in practice, measurement issues should be resolved first through EFAs and possibly CFAs. 
